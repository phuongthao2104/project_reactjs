{"version":3,"file":"react-use-cart.es.js","sources":["../src/useLocalStorage.js","../src/index.js"],"sourcesContent":["import { useState } from 'react'\n\nexport default function useLocalStorage(key, initialValue) {\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item =\n        typeof window !== 'undefined' && window.localStorage.getItem(key)\n\n      return item ? item : initialValue\n    } catch (error) {\n      return initialValue\n    }\n  })\n\n  const setValue = value => {\n    try {\n      const valueToStore =\n        value instanceof Function ? value(storedValue) : value\n\n      setStoredValue(valueToStore)\n\n      window.localStorage.setItem(key, valueToStore)\n    } catch (error) {\n      console.log(error)\n    }\n  }\n\n  return [storedValue, setValue]\n}\n","import React, { createContext, useContext, useReducer, useEffect } from \"react\";\n\nimport useLocalStorage from \"./useLocalStorage\";\n\nconst SET_ITEMS = \"SET_ITEMS\";\nconst ADD_ITEM = \"ADD_ITEM\";\nconst UPDATE_ITEM = \"UPDATE_ITEM\";\nconst REMOVE_ITEM = \"REMOVE_ITEM\";\nconst EMPTY_CART = \"EMPTY_CART\";\n\nconst CartContext = createContext();\n\nexport const initialState = {\n  items: [],\n  totalItems: 0,\n  totalUniqueItems: 0,\n  isEmpty: true,\n};\n\nexport const useCart = () => useContext(CartContext);\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case SET_ITEMS:\n      return generateCartState(state, action.payload);\n\n    case ADD_ITEM: {\n      const items = [...state.items, action.payload];\n\n      return generateCartState(state, items);\n    }\n\n    case UPDATE_ITEM: {\n      const items = state.items.map((item) => {\n        if (item.id !== action.id) return item;\n\n        return {\n          ...item,\n          ...action.payload,\n        };\n      });\n\n      return generateCartState(state, items);\n    }\n\n    case REMOVE_ITEM: {\n      const items = state.items.filter((i) => i.id !== action.id);\n\n      return generateCartState(state, items);\n    }\n\n    case EMPTY_CART:\n      return initialState;\n\n    default:\n      throw new Error(\"No action specified\");\n  }\n}\n\nconst generateCartState = (state = initialState, items = []) => {\n  const totalUniqueItems = calculateUniqueItems(items);\n  const isEmpty = totalUniqueItems === 0;\n\n  return {\n    ...initialState,\n    ...state,\n    items: calculateItemTotals(items),\n    totalItems: calculateTotalItems(items),\n    totalUniqueItems,\n    cartTotal: calculateCartTotal(items),\n    isEmpty,\n  };\n};\n\nconst calculateItemTotals = (items = []) =>\n  items.map((item) => ({\n    itemTotal: item.price * item.quantity,\n    ...item,\n  }));\n\nconst calculateCartTotal = (items = []) =>\n  items.reduce((total, item) => total + item.quantity * item.price, 0);\n\nconst calculateTotalItems = (items = []) =>\n  items.reduce((sum, item) => sum + item.quantity, 0);\n\nconst calculateUniqueItems = (items = []) => items.length;\n\nexport function CartProvider({\n  children,\n  id = [...Array(12)]\n    .map((i) => (~~(Math.random() * 36)).toString(36))\n    .join(\"\"),\n  defaultItems = [],\n  onSetItems,\n  onItemAdd,\n  onItemUpdate,\n  onItemRemove,\n}) {\n  const [savedCart, saveCart] = useLocalStorage(\n    \"react-use-cart\",\n    JSON.stringify({\n      id,\n      ...initialState,\n      items: defaultItems,\n    })\n  );\n\n  const [state, dispatch] = useReducer(reducer, JSON.parse(savedCart));\n\n  useEffect(() => {\n    saveCart(JSON.stringify(state));\n  }, [state, saveCart]);\n\n  const setItems = (items) => {\n    dispatch({\n      type: SET_ITEMS,\n      payload: items,\n    });\n\n    onSetItems && onSetItems(items);\n  };\n\n  const addItem = (item, quantity = 1) => {\n    if (quantity <= 0) return;\n    if (!item.id) throw new Error(\"You must provide an `id` for items\");\n\n    const currentItem = state.items.find((i) => i.id === item.id);\n\n    if (!currentItem & !item.price)\n      throw new Error(\"You must pass a `price` for new items\");\n\n    if (!currentItem) {\n      const payload = { ...item, quantity };\n      onItemAdd && onItemAdd(payload);\n      return dispatch({ type: ADD_ITEM, payload });\n    }\n\n    const payload = { ...item, quantity: currentItem.quantity + quantity };\n\n    dispatch({\n      type: UPDATE_ITEM,\n      id: item.id,\n      payload,\n    });\n\n    onItemUpdate && onItemUpdate(payload);\n  };\n\n  const updateItem = (id, payload) => {\n    dispatch({ type: UPDATE_ITEM, id, payload });\n    onItemUpdate && onItemUpdate(payload);\n  };\n\n  const updateItemQuantity = (id, quantity) => {\n    if (quantity <= 0) {\n      onItemRemove && onItemRemove(id);\n      return dispatch({ type: REMOVE_ITEM, id });\n    }\n\n    const currentItem = state.items.find((item) => item.id === id);\n\n    if (!currentItem) throw new Error(\"No such item to update\");\n\n    const payload = { ...currentItem, quantity };\n\n    dispatch({\n      type: UPDATE_ITEM,\n      id,\n      payload,\n    });\n\n    onItemUpdate && onItemUpdate(payload);\n  };\n\n  const removeItem = (id) => {\n    dispatch({ type: REMOVE_ITEM, id });\n\n    onItemRemove && onItemRemove(id);\n  };\n\n  const emptyCart = () =>\n    dispatch({\n      type: EMPTY_CART,\n    });\n\n  const getItem = (id) => state.items.find((i) => i.id === id);\n\n  const inCart = (id) => state.items.some((i) => i.id === id);\n\n  return (\n    <CartContext.Provider\n      value={{\n        ...state,\n        getItem,\n        inCart,\n        setItems,\n        addItem,\n        updateItem,\n        updateItemQuantity,\n        removeItem,\n        emptyCart,\n      }}\n    >\n      {children}\n    </CartContext.Provider>\n  );\n}\n"],"names":["useLocalStorage","key","initialValue","useState","item","window","localStorage","getItem","error","storedValue","setStoredValue","setValue","value","valueToStore","Function","setItem","console","log","SET_ITEMS","ADD_ITEM","UPDATE_ITEM","REMOVE_ITEM","EMPTY_CART","CartContext","createContext","initialState","items","totalItems","totalUniqueItems","isEmpty","useCart","useContext","reducer","state","action","type","generateCartState","payload","map","id","filter","i","Error","calculateUniqueItems","calculateItemTotals","calculateTotalItems","cartTotal","calculateCartTotal","itemTotal","price","quantity","reduce","total","sum","length","CartProvider","children","Array","Math","random","toString","join","defaultItems","onSetItems","onItemAdd","onItemUpdate","onItemRemove","JSON","stringify","savedCart","saveCart","useReducer","parse","dispatch","useEffect","setItems","addItem","currentItem","find","updateItem","updateItemQuantity","removeItem","emptyCart","inCart","some"],"mappings":"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"}